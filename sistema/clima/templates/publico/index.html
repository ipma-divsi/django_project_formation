{% load static %}
<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <title>IMA ‚Äì Mapa Meteorol√≥gico</title>

    <!-- Leaflet -->
    <link
        rel="stylesheet"
        href="https://unpkg.com/leaflet/dist/leaflet.css"
    />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>


    <style>
        /* GLOBAL */
        body {
            margin: 0;
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(to bottom, #e0f7fa, #ffffff);
            color: #222;
        }

        a {
            color: #003366;
            text-decoration: none;
            font-weight: bold;
            transition: 0.3s;
        }

        a:hover {
            color: #00509e;
        }

        /* MENU */
        .menu {
            background: #003366;
            padding: 12px 30px;
            display: flex;
            gap: 20px;
        }

        .menu a {
            color: white;
        }

        .menu a:hover {
            text-decoration: underline;
        }

        header {
            background: #00509e;
            color: white;
            padding: 20px 40px;
            text-align: center;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        header h1 {
            margin: 0;
            font-size: 28px;
        }

        header p {
            margin: 5px 0 0 0;
            font-size: 16px;
            font-weight: 400;
        }

        /* TOP BAR */
        .top-bar {
            background: white;
            padding: 12px 20px;
            border-bottom: 1px solid #ccc;
            text-align: center;
            font-weight: bold;
            color: #003366;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        /* CONTAINER FLEX */
        .container {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin: 25px;
            flex-wrap: wrap;
        }

        /* AVISOS */
        .avisos {
            width: 300px;
            max-height: 500px;
            background: white;
            border-radius: 10px;
            padding: 20px;
            overflow-y: auto;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        .avisos h3 {
            text-align: center;
            color: #003366;
            margin-top: 0;
            font-size: 20px;
        }

        .aviso {
            border-left: 6px solid;
            background: #f0f9ff;
            padding: 12px;
            margin-bottom: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s, transform 0.2s;
        }

        .aviso:hover {
            background: #e0f3fc;
            transform: translateX(3px);
        }

        /* N√≠veis de alerta */
        .nivel-Verde { border-color: #28a745; }
        .nivel-Amarelo { border-color: #ffc107; }
        .nivel-Laranja { border-color: #fd7e14; }
        .nivel-Vermelho { border-color: #dc3545; }

        /* MAPA */
        #map {
            width: 700px;
            height: 500px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        .popup {
            text-align: center;
            font-size: 14px;
        }

        .icon {
            font-size: 26px;
        }

        .temp {
            font-weight: bold;
        }

        @media (max-width: 1024px) {
            .container {
                flex-direction: column;
                align-items: center;
            }

            #map {
                width: 90%;
            }
        }
        /* DROPDOWN MENU */
       .dropdown {
        position: relative;
         display: inline-block;
        }

        .dropbtn {
        color: white;
        cursor: pointer;
        }

        .dropdown-content {
        display: none;
        position: absolute;
        background-color: white;
        min-width: 260px;
        box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        border-radius: 8px;
        z-index: 1000;
        margin-top: 10px;
        }

        .dropdown-content a {
        color: #003366;
        padding: 12px 18px;
        display: block;
        font-weight: normal;
        }

        .dropdown-content a:hover {
        background-color: #f0f7ff;
        border-radius: 8px;
        }

    </style>
</head>
<body>

<!-- MENU -->
<nav class="menu">
    <a href="{% url 'clima:inicio' %}">In√≠cio</a>
    <div class="dropdown">
    <a href="javascript:void(0)" class="dropbtn" onclick="toggleMenu()">Tempo ‚ñæ</a>
    <div class="dropdown-content" id="submenu-tempo">
        <a href="{% url 'clima:previsao_10_dias' %}"> Previs√£o 5 dias e hor√°rios</a>
        <a href="{% url 'clima:previsao_descritiva' %}">Previs√£o descritiva</a>
        <a href="{% url 'clima:estacoes_online' %}">Esta√ß√µes online</a>
    </div>
</div>

    </div>
    <a href="{% url 'clima:mar' %}">Mar</a>
    <a href="{% url 'clima:noticias' %}">Not√≠cias</a>
</nav>

<!-- HEADER -->
<header>
    <h1>Instituto do Mar e da Atmosfera</h1>
    <p>Mapa Meteorol√≥gico de Portugal</p>
</header>

<!-- TOP BAR -->
<div class="top-bar">
    Previs√£o Meteorol√≥gica em Tempo Real
</div>

<!-- CONTAINER -->
<div class="container">

    <!-- AVISOS -->
    <div class="avisos">
        <h3>‚ö†Ô∏è Avisos</h3>

        {% for aviso in avisos %}
            <div class="aviso
                {% if aviso.nivel == 'verde' %}nivel-Verde{% elif aviso.nivel == 'amarelo' %}nivel-Amarelo{% elif aviso.nivel == 'laranja' %}nivel-Laranja{% elif aviso.nivel == 'vermelho' %}nivel-Vermelho{% endif %}"
                onclick="location.href='{% url 'detalhe_aviso' aviso.id %}'">
                <strong>{{ aviso.titulo }}</strong><br>
                {{ aviso.descricao|truncatechars:80 }}
            </div>
        {% empty %}
            <p>Sem avisos Meteorol√≥gico.</p>
        {% endfor %}
    </div>

   <div id="map"></div>

<script>
var limitesPortugal = [
    [32.5, -31.5],  // sudoeste A√ßores
    [42.5, -6.0]    // nordeste Portugal continental
];

var map = L.map('map', {
    maxBounds: limitesPortugal,
    maxBoundsViscosity: 1.0,
    minZoom: 5,
    maxZoom: 9
}).setView([38.5, -10.0], 6);

// Tiles
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '¬© OpenStreetMap'
}).addTo(map);

// Fun√ß√£o para escolher √≠cone de clima baseado na temperatura m√°xima
function iconeClima(tmax) {
    var t = parseFloat(tmax);
    if (!isNaN(t)) {
        if (t >= 25) return "‚òÄÔ∏è";
        if (t >= 15) return "‚õÖ";
        return "üåßÔ∏è";
    }
    return "‚ùì";
}

// Fun√ß√£o para criar marcador com popup
function adicionarMarcador(c) {
     var marker = L.marker([c.lat, c.lon]).addTo(map);

    var popupHtml = `
        <div style="text-align:center;">
            <b>${c.nome}</b><br>
            üå°Ô∏è M√≠n: ${c.tmin}¬∞C<br>
            üå°Ô∏è M√°x: ${c.tmax}¬∞C
        </div>
    `;
    marker.bindPopup(popupHtml);
}

// Lista de cidades do Django
var cidades = [
    {% for c in cidades %}
    {
        nome: "{{ c.nome }}",
        lat: {{ c.lat }},
        lon: {{ c.lon }},
        tmin: "{{ c.tmin }}",
        tmax: "{{ c.tmax }}"
    },
    {% endfor %}
];

// Adiciona todos os marcadores
cidades.forEach(adicionarMarcador);
</script>
<script>
function toggleMenu() {
    const menu = document.getElementById("submenu-tempo");
    menu.style.display = menu.style.display === "block" ? "none" : "block";
}

document.addEventListener("click", function(e) {
    const dropdown = document.querySelector(".dropdown");
    const menu = document.getElementById("submenu-tempo");

    if (!dropdown.contains(e.target)) {
        menu.style.display = "none";
    }
});
</script>
</body>
</html>
